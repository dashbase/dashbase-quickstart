version: '3.4'
services:
  kafka:
    deploy:
      placement:
        constraints:
          - node.labels.core == true
        preferences:
          - spread: node.labels.kafka
volumes:
  kafka_data:
    driver: rexray/ebs
    driver_opts:
      volumetype: "st1"
      size: 500
      encrypted: "true"